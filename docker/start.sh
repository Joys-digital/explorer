#!/bin/bash
TESTNET=0
cd /opt/explorer
git pull
service mongodb start

if [ $TESTNET -eq 1 ]
then
    BOOTNODES="--bootnodes=enode://8401883922960f919b663b2109029cfc3be5cac68a2a6386fdfd404c834fa517c4ca970e8d9463a4b632cfb2031e661cf6630b87f23fff2ee0de86a526a3845f@137.74.162.146:30308"
    BOOTNODES="$BOOTNODES,enode://5618ab2920ed59e0312b7c70af7f8c1a83db5990e0c1df0a3ac3d8c326f640b3038f24da2d1264fca70dd5faa9c41e38c3fa28fd9553aa8284310be05853a1d7@137.74.162.146:30304"
    TESTNET="--testnet"
else
    BOOTNODES="--bootnodes=enode://42e80282656545c01ab78e47dfa0d664ad5d7468643e81a05b8d17d4c269a9fbf30ffd23cfa065a4599ffa16b7700ed0a0c075c0a027641f9c7e1f765dcad659@158.69.209.240:30307"
    BOOTNODES="$BOOTNODES,enode://d4681c54ae0055591f4cf473e85e60ad47c564c7760d2fed7fc25ada06cdb4a845d8f0768e640a0e790cca3e1beb924ec3b4a4e51deb9d169c271bf1b2632f0b@149.56.99.203:30307"
    BOOTNODES="$BOOTNODES,enode://155db7f85443ae6b8f68e1dae7c2c89a2dd537239732bf0400ba18324fcc0ee866b2066cbb8b4a1994c13c83cb4e78197041822030a05b257e0144f7f1c61354@137.74.162.146:30307"
    BOOTNODES="$BOOTNODES,enode://8401883922960f919b663b2109029cfc3be5cac68a2a6386fdfd404c834fa517c4ca970e8d9463a4b632cfb2031e661cf6630b87f23fff2ee0de86a526a3845f@94.130.105.46:30307"
    BOOTNODES="$BOOTNODES,enode://fe4a3fe3822c25052502481954e4ba2088e9662e6059af235e2d7f67ce90a9f30b6dc5478ca2d82fe7e98cc806276c62bf88cd8213bd13c2d1f0199784d6b1b4@94.130.111.226:30307"
    BOOTNODES="$BOOTNODES,enode://9b35465e4dc22b143cc9d32bc506d0773c68c2f3f79a4473b5eefd0629288cdf3d0d2ea188accbe9775e35ff058478ad09e520a77f7aca06a7c32385fcde173c@158.69.209.240:30303"
    BOOTNODES="$BOOTNODES,enode://8ce4f7b3d566ed61d8a97ffd4f5e6749bd0f6371ce97729178fb66cc861648028842103439e9e003bdbd21307b0167298aac3f055f6b4eab981e02f26eac51b7@137.74.162.146:30303"
    BOOTNODES="$BOOTNODES,enode://a6b2c7a2e8c72034d767e749818a8d85c9e693a75138ddb59e005501cd2ccf3688fa8ed50daa2cd8de927fd9dd760f191072032a1f629a4eae528acf1f1c2d25@94.130.105.46:30303"
    BOOTNODES="$BOOTNODES,enode://f001337f64ef88bc595e5304713fa9148407cee2062ba1de58c5200eda3206d7a9dd715ebe5844fc724d3a31909bcc4bbfbfefe7c6f9536ed969c3362b22939a@94.130.111.226:30303"
fi

sudo -u explorer /opt/geth_linux --datadir /opt/geth_datadir --rpc $BOOTNODES $TESTNET &
sleep 15
echo "Starting grabber"
sudo -u explorer node /opt/explorer/tools/grabber.js &
sleep 15
echo "Starting explorer"
service mongodb status
sudo -u explorer node /opt/explorer/app.js